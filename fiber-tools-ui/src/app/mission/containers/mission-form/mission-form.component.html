<mat-card>
  <!-- Chantier-->
  <mat-card-title>{{(mission$ |  async )?.number}}</mat-card-title>

  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="submit()">
      <!-- Touret -->
      <mat-form-field>
        <mat-label>Touret</mat-label>
        <input matInput readonly type="text" />
      </mat-form-field>
      <!-- Photos des chambres-->
      <mat-vertical-stepper>
        <!-- Custom icon with a context variable. -->
        <ng-template matStepperIcon="number" let-index="index">
          <div class="index">
            {{index + 1}}
          </div>
        </ng-template>
        <mat-step formArrayName="checkPoints" *ngFor="let checkPoint of formCheckPointsControls; let i = index;"
          [stepControl]="checkPoint">
          <ng-template matStepLabel>
            <div>
              <app-check-point-icon *ngIf="(mission$ | async)?.checkPoints[i]"
                [checkPoint]="(mission$ | async)?.checkPoints[i]">
              </app-check-point-icon>
              {{(mission$ | async)?.checkPoints[i]?.ref}}
            </div>
          </ng-template>
          <br>
          <mat-chip-list *ngIf="i!==0">
            <mat-chip>
              <p><b>Distance: </b> {{(mission$ | async)?.links[i-1]?.value}} m</p>
            </mat-chip>
            <mat-chip>
              <p>{{(mission$ | async).sectionPreffixFromFirst}}-{{(mission$ | async)?.links[i-1]?.section}}</p>
            </mat-chip>
          </mat-chip-list>
          <br>
          <mat-divider></mat-divider>
          <br>
          <div *ngFor="let picture of checkPoint.controls; let j = index;" [formArrayName]="i">
            <app-picture-input [label]="(mission$ | async)?.checkPoints[i]?.properties?.requiredPhotos[j]?.label"
              [url]="(mission$ | async)?.checkPoints[i]?.properties?.requiredPhotos[j]?.url" [formControlName]="j">
            </app-picture-input>
          </div>
          <br>
          <mat-divider></mat-divider>
          <br>
          <mat-chip-list *ngIf="(mission$ | async)?.links[i]">
            <mat-chip>
              <p><b>Distance: </b> {{(mission$ | async)?.links[i]?.value}} m</p>
            </mat-chip>
            <mat-chip>
              <p>{{(mission$ | async).sectionPreffixFromFirst}}-{{(mission$ | async)?.links[i]?.section}}</p>
            </mat-chip>
          </mat-chip-list>
        </mat-step>
      </mat-vertical-stepper>
    </form>
    <ng-container *ngIf="(mission$|async)?.comments">
      <app-comment-display *ngFor="let comment of (mission$ | async)?.comments" [comment]="comment">
      </app-comment-display>
    </ng-container>
    <mat-spinner [diameter]="25" *ngIf="writingComment$ | async"></mat-spinner>
    <app-comment-edit [disabled]="writingComment$ | async" (send)="addComment($event)"></app-comment-edit>
  </mat-card-content>
  <mat-card-actions align="end">
    <!-- <button type="submit" [disabled]="form.invalid" mat-button>Enregistrer</button> -->
  </mat-card-actions>
</mat-card>